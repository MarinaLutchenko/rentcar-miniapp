<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RentCarNT</title>

  <style>
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
      background:#0e0e0e;
      color:#fff;
    }
html, body {
  height: 100%;
  overflow-x: hidden;
}

.container {
  min-height: 100%;
}
   .container{
  padding:20px;
  max-width:520px;
  margin:0 auto;
  overflow:hidden;
}

    h1{
      font-size:22px;
      margin:0 0 18px;
    }

    .subtitle{
      color:#8b8b8b;
      font-size:14px;
      margin-bottom:14px;
      line-height:1.35;
    }

    .card{
      background:#1c1c1c;
      padding:16px;
      border-radius:16px;
      margin-bottom:12px;
      cursor:pointer;
      transition:.15s;
      border:1px solid transparent;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    .card:hover{ border:1px solid #2ecc71; }
    .card:active{ transform: scale(0.99); }

    *{
  box-sizing:border-box;
}

*{
  box-sizing:border-box;
}

.btn{
  display:block;
  width:calc(100% - 0px);
  padding:16px;
  border-radius:14px;
  font-size:16px;
  font-weight:700;
  margin-top:12px;
  text-align:center;
  cursor:pointer;
  border:none;
  text-decoration:none;
}
.btn.primary{
  background:#2ecc71;
  color:#0e0e0e !important;
}

.btn.secondary{
  background:#1c1c1c;
  color:#ffffff !important;
  border:1px solid #2b2b2b;
  font-weight:600;
}
    input{
      width:100%;
      padding:14px;
      margin-bottom:12px;
      border-radius:12px;
      border:none;
      background:#1c1c1c;
      color:#fff;
      font-size:15px;
      outline:none;
    }

    /* –í–ê–ñ–ù–û: hidden –¥–æ–ª–∂–µ–Ω –ø–µ—Ä–µ–±–∏–≤–∞—Ç—å –≤—Å—ë */
    .hidden{ display:none !important; }

    .success{
      background:#1c1c1c;
      padding:18px;
      border-radius:16px;
      text-align:center;
    }
    .success h2{
      margin:0 0 10px;
      font-size:22px;
      word-break:break-word;
    }
    .success p{
      margin:0;
      word-break:break-word;
    }

    .hint{
      margin-top:12px;
      color:#9a9a9a;
      font-size:13px;
      line-height:1.35;
    }

    .errorBox{
      margin-top:14px;
      background:#2b1515;
      border:1px solid #8a2e2e;
      color:#ffd9d9;
      padding:12px;
      border-radius:12px;
      font-size:13px;
      white-space:pre-wrap;
    }

    /* ‚úÖ –≠–∫—Ä–∞–Ω —É—Å–ø–µ—Ö–∞: —Ü–µ–Ω—Ç—Ä + –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —à–∏—Ä–∏–Ω—ã (—á—Ç–æ–±—ã ‚Äú–Ω–µ —Ä–∞—Å–ø–æ–ª–∑–∞–ª–æ—Å—å‚Äù) */
    
    .successWrap{
      width:100%;
      max-width:420px;  /* –≤–æ—Ç —ç—Ç–æ –∏ –µ—Å—Ç—å ‚Äú–Ω–µ –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω‚Äù */
      margin:0 auto;
    }
  </style>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>

<body>
  <div class="container">

    <!-- –≠–ö–†–ê–ù 1: –ì–û–†–û–î -->
    <div id="screen-city">
      <h1>–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥ –∞—Ä–µ–Ω–¥—ã</h1>

      <div class="card" onclick="selectCity('–ù—è—á–∞–Ω–≥')">üèù –ù—è—á–∞–Ω–≥</div>
      <div class="card" onclick="selectCity('–ú—É–π–Ω–µ/–§–∞–Ω—Ç—å–µ—Ç')">üå¥ –ú—É–π–Ω–µ/–§–∞–Ω—Ç—å–µ—Ç</div>
      <div class="card" onclick="selectCity('–§—É–∫—É–æ–∫')">üèñÔ∏è –§—É–∫—É–æ–∫</div>
      <div class="card" onclick="selectCity('–î–∞–Ω–∞–Ω–≥')">üåÖ –î–∞–Ω–∞–Ω–≥</div>
      <div class="card" onclick="selectCity('–•–æ—à–∏–º–∏–Ω')">üèô –•–æ—à–∏–º–∏–Ω</div>
      <div class="card" onclick="selectCity('–•–∞–Ω–æ–π')">üèõ –•–∞–Ω–æ–π</div>

      <div id="error-city" class="errorBox hidden"></div>
    </div>

    <!-- –≠–ö–†–ê–ù 2: –°–ï–ì–ú–ï–ù–¢ -->
    <div id="screen-segment" class="hidden">
      <h1>–ö–∞–∫–æ–π —Ñ–æ—Ä–º–∞—Ç –∞–≤—Ç–æ –≤–∞–º –ø–æ–¥–æ–π–¥—ë—Ç?</h1>

      <div class="card" onclick="selectSegment('–ë–∞–ª–∞–Ω—Å –∫–æ–º—Ñ–æ—Ä—Ç–∞ –∏ –ø—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç–∏')">üöó –ë–∞–ª–∞–Ω—Å –∫–æ–º—Ñ–æ—Ä—Ç–∞ –∏ –ø—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç–∏</div>
      <div class="card" onclick="selectSegment('–ö–æ–º—Ñ–æ—Ä—Ç –¥–ª—è —Ç—Ä–∞—Å—Å—ã –∏ –≥–æ—Ä–Ω—ã—Ö –¥–æ—Ä–æ–≥')">üöô –ö–æ–º—Ñ–æ—Ä—Ç –¥–ª—è —Ç—Ä–∞—Å—Å—ã –∏ –≥–æ—Ä–Ω—ã—Ö –¥–æ—Ä–æ–≥</div>
      <div class="card" onclick="selectSegment('–ü—Ä–æ—Å—Ç–æ—Ä –¥–ª—è —Å–µ–º—å–∏ –∏ –∫–æ–º–ø–∞–Ω–∏–∏')">üë®‚Äçüë©‚Äçüëß –ü—Ä–æ—Å—Ç–æ—Ä –¥–ª—è —Å–µ–º—å–∏ –∏ –∫–æ–º–ø–∞–Ω–∏–∏</div>
      <div class="card" onclick="selectSegment('–≠–ª–µ–∫—Ç—Ä–æ–º–æ–±–∏–ª–∏ –Ω–æ–≤–æ–≥–æ –ø–æ–∫–æ–ª–µ–Ω–∏—è')">‚ö° –≠–ª–µ–∫—Ç—Ä–æ–º–æ–±–∏–ª–∏ –Ω–æ–≤–æ–≥–æ –ø–æ–∫–æ–ª–µ–Ω–∏—è</div>
      <div class="card" onclick="selectSegment('–ë–∏–∑–Ω–µ—Å –∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—å—Å–∫–∏–π –∫–ª–∞—Å—Å')">üíé –ë–∏–∑–Ω–µ—Å –∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—å—Å–∫–∏–π –∫–ª–∞—Å—Å</div>

      <button class="btn secondary" onclick="backTo('screen-city')">‚Üê –ù–∞–∑–∞–¥</button>
      <div id="error-segment" class="errorBox hidden"></div>
    </div>

    <!-- –≠–ö–†–ê–ù 3: –ú–ê–®–ò–ù–´ -->
    <div id="screen-car" class="hidden">
      <h1>–í—ã–±–µ—Ä–∏—Ç–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—å</h1>
      <div class="subtitle">–ü–æ–∫–∞–∂–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –∏–∑ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞.</div>

      <div id="car-list"></div>

      <button class="btn secondary" onclick="backTo('screen-segment')">‚Üê –ù–∞–∑–∞–¥</button>
      <div id="error-car" class="errorBox hidden"></div>
    </div>

    <!-- –≠–ö–†–ê–ù 4: –î–ê–¢–´ -->
    <div id="screen-dates" class="hidden">
      <h1>–£–∫–∞–∂–∏—Ç–µ –¥–∞—Ç—ã –∞—Ä–µ–Ω–¥—ã</h1>
      <div class="subtitle">–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—ã –ø–æ–µ–∑–¥–∫–∏ (–±–µ–∑ –≤—Ä–µ–º–µ–Ω–∏ ‚Äî —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ).</div>

      <input type="date" id="dateFrom" />
      <input type="date" id="dateTo" />

      <button class="btn" onclick="goToContacts()">–î–∞–ª–µ–µ</button>
      <button class="btn secondary" onclick="backTo('screen-car')">‚Üê –ù–∞–∑–∞–¥</button>

      <div id="error-dates" class="errorBox hidden"></div>
    </div>

    <!-- –≠–ö–†–ê–ù 5: –ö–û–ù–¢–ê–ö–¢–´ -->
    <div id="screen-contacts" class="hidden">
      <h1>–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h1>
      <div class="subtitle">–ú–µ–Ω–µ–¥–∂–µ—Ä —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.</div>

      <input type="text" id="clientName" placeholder="–í–∞—à–µ –∏–º—è" />
      <input type="text" id="clientContact" placeholder="Telegram –∏–ª–∏ WhatsApp" />

      <button class="btn" onclick="sendBooking()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
      <button class="btn secondary" onclick="backTo('screen-dates')">‚Üê –ù–∞–∑–∞–¥</button>

      <div id="error-contacts" class="errorBox hidden"></div>
    </div>

    <!-- –≠–ö–†–ê–ù 6: –£–°–ü–ï–• -->
    <div id="screen-success" class="hidden">
      <div class="successWrap">

        <div class="success">
          <h2>‚úÖ –ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞</h2>
          <p>–ú–µ–Ω–µ–¥–∂–µ—Ä —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.</p>
          <div class="hint">–ï—Å–ª–∏ –≤–æ–ø—Ä–æ—Å —Å—Ä–æ—á–Ω—ã–π ‚Äî –Ω–∞–ø–∏—à–∏—Ç–µ –Ω–∞–º –Ω–∞–ø—Ä—è–º—É—é –≤ Telegram.</div>
        </div>

        <a class="btn primary" href="https://t.me/RentCarNT" target="_blank" rel="noopener noreferrer">
          ‚úâÔ∏è –ù–∞–ø–∏—Å–∞—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä—É
        </a>

        <button class="btn secondary" onclick="resetFlow()">–û—Å—Ç–∞–≤–∏—Ç—å –µ—â—ë –∑–∞—è–≤–∫—É</button>

      </div>
    </div>

  </div>

<script>
  // ‚úÖ —Ç–≤–æ–π –≤–µ—Ä–Ω—ã–π Apps Script URL (–ù–ï –¢–†–û–ì–ê–ï–ú)
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw83bucvRMn2_TNmmLoDhnVSL5Eeh3nA01-ANetMaGh7sqET43VMiTcxVKt24mx_aU/exec";

  let bookingData = {};

  const cars = {
    "–ë–∞–ª–∞–Ω—Å –∫–æ–º—Ñ–æ—Ä—Ç–∞ –∏ –ø—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç–∏": [
      { name:"Hyundai Kona", price:40 },
      { name:"Mazda 2", price:35 },
      { name:"Mazda 3", price:40 },
      { name:"Honda City", price:35 }
    ],
    "–ö–æ–º—Ñ–æ—Ä—Ç –¥–ª—è —Ç—Ä–∞—Å—Å—ã –∏ –≥–æ—Ä–Ω—ã—Ö –¥–æ—Ä–æ–≥": [
      { name:"Mazda CX-5", price:52 },
      { name:"Mazda CX-30", price:50 },
      { name:"Hyundai Creta", price:45 }
    ],
    "–ü—Ä–æ—Å—Ç–æ—Ä –¥–ª—è —Å–µ–º—å–∏ –∏ –∫–æ–º–ø–∞–Ω–∏–∏": [
      { name:"Xpander (7 –º–µ—Å—Ç)", price:55 },
      { name:"Carens (7 –º–µ—Å—Ç)", price:65 }
    ],
    "–≠–ª–µ–∫—Ç—Ä–æ–º–æ–±–∏–ª–∏ –Ω–æ–≤–æ–≥–æ –ø–æ–∫–æ–ª–µ–Ω–∏—è": [
      { name:"VinFast VF7", price:60 },
      { name:"VinFast VF5", price:45 }
    ],
    "–ë–∏–∑–Ω–µ—Å –∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—å—Å–∫–∏–π –∫–ª–∞—Å—Å": [
      { name:"Mercedes C300", price:95 }
    ]
  };

  function show(screenId){
    document.querySelectorAll('[id^="screen-"]').forEach(el => el.classList.add('hidden'));
    const el = document.getElementById(screenId);
    if (el) el.classList.remove('hidden');
  }

  function backTo(screenId){ show(screenId); }

  function setError(id, text){
    const el = document.getElementById(id);
    if (!el) return;
    if (!text) {
      el.classList.add("hidden");
      el.textContent = "";
      return;
    }
    el.classList.remove("hidden");
    el.textContent = text;
  }

  function selectCity(city){
    bookingData = {};
    bookingData.city = city;
    setError("error-city", "");
    show("screen-segment");
  }

  function selectSegment(segment){
    bookingData.segment = segment;
    setError("error-segment", "");

    const list = document.getElementById("car-list");
    list.innerHTML = "";

    const items = cars[segment] || [];
    if (!items.length) {
      setError("error-car", "–ü–æ–∫–∞ –Ω–µ—Ç –º–∞—à–∏–Ω –≤ —ç—Ç–æ–º —Ñ–æ—Ä–º–∞—Ç–µ. –í—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥–æ–π —Ñ–æ—Ä–º–∞—Ç.");
      show("screen-car");
      return;
    }

    items.forEach(car => {
      const div = document.createElement("div");
      div.className = "card";
      div.onclick = () => selectCar(car.name, car.price);
      div.innerHTML = `
        <strong>${car.name}</strong><br>
        <span style="color:#2ecc71;">–æ—Ç $${car.price} / —Å—É—Ç–∫–∏</span>
      `;
      list.appendChild(div);
    });

    show("screen-car");
  }

  function selectCar(name, price){
    bookingData.car = name;
    bookingData.price = price;
    setError("error-car", "");
    show("screen-dates");
  }

  function goToContacts(){
    const from = document.getElementById("dateFrom").value;
    const to = document.getElementById("dateTo").value;

    if (!from || !to) {
      setError("error-dates", "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ–±–µ –¥–∞—Ç—ã.");
      return;
    }
    if (to < from) {
      setError("error-dates", "–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–Ω—å—à–µ –¥–∞—Ç—ã –Ω–∞—á–∞–ª–∞.");
      return;
    }

    bookingData.dateFrom = from;
    bookingData.dateTo = to;
    bookingData.dates = `${from} ‚Äî ${to}`;

    setError("error-dates", "");
    show("screen-contacts");
  }

  async function sendBooking(){
    const name = (document.getElementById("clientName").value || "").trim();
    const contact = (document.getElementById("clientContact").value || "").trim();

    if (!name || !contact) {
      setError("error-contacts", "–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ –∫–æ–Ω—Ç–∞–∫—Ç (Telegram/WhatsApp).");
      return;
    }

    bookingData.name = name;
    bookingData.contact = contact;
    bookingData.type = "miniapp_booking"; // –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –±—ã–ª–æ

    setError("error-contacts", "");

    try {
      // ‚úÖ –ö–õ–Æ–ß–ï–í–û–ï: –±–µ–∑ headers, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ CORS/preflight
      const res = await fetch(SCRIPT_URL, {
        method: "POST",
        body: JSON.stringify(bookingData)
      });

      // –µ—Å–ª–∏ –æ—Ç–≤–µ—Ç —á–∏—Ç–∞–µ—Ç—Å—è ‚Äî –ø—Ä–æ–≤–µ—Ä–∏–º, –µ—Å–ª–∏ –Ω–µ—Ç ‚Äî –≤—Å—ë —Ä–∞–≤–Ω–æ —Å—á–∏—Ç–∞–µ–º —É—Å–ø–µ—Ö–æ–º, —Ä–∞–∑ fetch –Ω–µ —É–ø–∞–ª
      let ok = true;
      try {
        const data = await res.json();
        ok = (data && data.status === "ok");
      } catch(e) {
        ok = true;
      }

      if (ok) {
        show("screen-success");
      } else {
        setError("error-contacts", "–°–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—Ç–∏–ª –æ—à–∏–±–∫–æ–π. –ü—Ä–æ–≤–µ—Ä—å Apps Script / –ª–∏—Å—Ç '–ó–∞—è–≤–∫–∏'.");
      }
    } catch (err) {
      setError("error-contacts", "–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:\n" + String(err));
    }
  }

  function resetFlow(){
    bookingData = {};
    document.getElementById("dateFrom").value = "";
    document.getElementById("dateTo").value = "";
    document.getElementById("clientName").value = "";
    document.getElementById("clientContact").value = "";

    setError("error-city", "");
    setError("error-segment", "");
    setError("error-car", "");
    setError("error-dates", "");
    setError("error-contacts", "");

    show("screen-city");
  }
function fixTelegramHeight() {
  if (window.Telegram && Telegram.WebApp) {
    const stableHeight = Telegram.WebApp.viewportStableHeight;
    document.body.style.height = stableHeight + "px";
  }
}

if (window.Telegram && Telegram.WebApp) {
  Telegram.WebApp.expand();
  fixTelegramHeight();
  Telegram.WebApp.onEvent('viewportChanged', fixTelegramHeight);
}
  resetFlow();
</script>

</body>
</html>
