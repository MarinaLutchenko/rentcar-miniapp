<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RentCarNT</title>

  <style>
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
      background:#0e0e0e;
      color:#fff;
    }
    .container{
      padding:20px;
      max-width:520px;
      margin:auto;
    }
    h1{
      font-size:22px;
      margin-bottom:18px;
    }
    .subtitle{
      color:#8b8b8b;
      font-size:14px;
      margin-bottom:14px;
      line-height:1.35;
    }
    .card{
      background:#1c1c1c;
      padding:16px;
      border-radius:16px;
      margin-bottom:12px;
      cursor:pointer;
      transition:.15s;
      border:1px solid transparent;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    .card:hover{ border:1px solid #2ecc71; }
    .card:active{ transform: scale(0.99); }

   .btn{
  display:block;
  width:100%;
  max-width:360px;        /* <- –∫–Ω–æ–ø–∫–∞ –Ω–µ —Ä–∞—Å—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω */
  margin:10px auto 0;     /* <- —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º */
  padding:16px;
  background:#2ecc71;
  border:none;
  border-radius:14px;
  font-size:16px;
  font-weight:700;
  cursor:pointer;
  color:#fff;             /* <- —á—Ç–æ–±—ã —Ç–µ–∫—Å—Ç –Ω–µ —Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è —á–µ—Ä–Ω—ã–º */
}
    .btn:active{ transform: scale(0.99); }
    .btn.secondary{
      background:#1c1c1c;
      color:#fff;
      border:1px solid #2b2b2b;
      font-weight:600;
    }

    input{
      width:100%;
      padding:14px;
      margin-bottom:12px;
      border-radius:12px;
      border:none;
      background:#1c1c1c;
      color:#fff;
      font-size:15px;
      outline:none;
    }

    .hidden{ display:none; }

    .success{
  background:#1c1c1c;
  padding:18px;
  border-radius:16px;
  text-align:center;
  max-width:420px;
  margin:0 auto 20px;
}

.success h2{
  font-size:20px;
  margin-bottom:12px;
  word-break:break-word;
}

.success p{
  margin:0;
  word-break:break-word;
}
    .hint{
      margin-top:12px;
      color:#9a9a9a;
      font-size:13px;
      line-height:1.35;
    }

    /* –º–∞–ª–µ–Ω—å–∫–∞—è –ø–ª–∞—à–∫–∞ –æ—à–∏–±–æ–∫ (—á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ "–±–µ–ª—ã–π —ç–∫—Ä–∞–Ω") */
    .errorBox{
      margin-top:14px;
      background:#2b1515;
      border:1px solid #8a2e2e;
      color:#ffd9d9;
      padding:12px;
      border-radius:12px;
      font-size:13px;
      white-space:pre-wrap;
    }
  </style>
</head>

<body>
  <div class="container">

    <!-- –≠–ö–†–ê–ù 1: –ì–û–†–û–î -->
    <div id="screen-city">
      <h1>–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥ –∞—Ä–µ–Ω–¥—ã</h1>

      <div class="card" onclick="selectCity('–ù—è—á–∞–Ω–≥')">üèù –ù—è—á–∞–Ω–≥</div>
      <div class="card" onclick="selectCity('–ú—É–π–Ω–µ/–§–∞–Ω—Ç—å–µ—Ç')">üå¥ –ú—É–π–Ω–µ/–§–∞–Ω—Ç—å–µ—Ç</div>
      <div class="card" onclick="selectCity('–§—É–∫—É–æ–∫')">üèñÔ∏è –§—É–∫—É–æ–∫</div>
      <div class="card" onclick="selectCity('–î–∞–Ω–∞–Ω–≥')">üåÖ –î–∞–Ω–∞–Ω–≥</div>
      <div class="card" onclick="selectCity('–•–æ—à–∏–º–∏–Ω')">üèô –•–æ—à–∏–º–∏–Ω</div>
      <div class="card" onclick="selectCity('–•–∞–Ω–æ–π')">üèõ –•–∞–Ω–æ–π</div>

      <div id="error-city" class="errorBox hidden"></div>
    </div>

    <!-- –≠–ö–†–ê–ù 2: –°–ï–ì–ú–ï–ù–¢ -->
    <div id="screen-segment" class="hidden">
      <h1>–ö–∞–∫–æ–π —Ñ–æ—Ä–º–∞—Ç –∞–≤—Ç–æ –≤–∞–º –ø–æ–¥–æ–π–¥—ë—Ç?</h1>

      <div class="card" onclick="selectSegment('–ë–∞–ª–∞–Ω—Å –∫–æ–º—Ñ–æ—Ä—Ç–∞ –∏ –ø—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç–∏')">üöó –ë–∞–ª–∞–Ω—Å –∫–æ–º—Ñ–æ—Ä—Ç–∞ –∏ –ø—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç–∏</div>
      <div class="card" onclick="selectSegment('–ö–æ–º—Ñ–æ—Ä—Ç –¥–ª—è —Ç—Ä–∞—Å—Å—ã –∏ –≥–æ—Ä–Ω—ã—Ö –¥–æ—Ä–æ–≥')">üöô –ö–æ–º—Ñ–æ—Ä—Ç –¥–ª—è —Ç—Ä–∞—Å—Å—ã –∏ –≥–æ—Ä–Ω—ã—Ö –¥–æ—Ä–æ–≥</div>
      <div class="card" onclick="selectSegment('–ü—Ä–æ—Å—Ç–æ—Ä –¥–ª—è —Å–µ–º—å–∏ –∏ –∫–æ–º–ø–∞–Ω–∏–∏')">üë®‚Äçüë©‚Äçüëß –ü—Ä–æ—Å—Ç–æ—Ä –¥–ª—è —Å–µ–º—å–∏ –∏ –∫–æ–º–ø–∞–Ω–∏–∏</div>
      <div class="card" onclick="selectSegment('–≠–ª–µ–∫—Ç—Ä–æ–º–æ–±–∏–ª–∏ –Ω–æ–≤–æ–≥–æ –ø–æ–∫–æ–ª–µ–Ω–∏—è')">‚ö° –≠–ª–µ–∫—Ç—Ä–æ–º–æ–±–∏–ª–∏ –Ω–æ–≤–æ–≥–æ –ø–æ–∫–æ–ª–µ–Ω–∏—è</div>
      <div class="card" onclick="selectSegment('–ë–∏–∑–Ω–µ—Å –∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—å—Å–∫–∏–π –∫–ª–∞—Å—Å')">üíé –ë–∏–∑–Ω–µ—Å –∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—å—Å–∫–∏–π –∫–ª–∞—Å—Å</div>

      <button class="btn secondary" onclick="backTo('screen-city')">‚Üê –ù–∞–∑–∞–¥</button>
      <div id="error-segment" class="errorBox hidden"></div>
    </div>

    <!-- –≠–ö–†–ê–ù 3: –ú–ê–®–ò–ù–´ -->
    <div id="screen-car" class="hidden">
      <h1>–í—ã–±–µ—Ä–∏—Ç–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—å</h1>
      <div class="subtitle">–ü–æ–∫–∞–∂–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –∏–∑ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞.</div>

      <div id="car-list"></div>

      <button class="btn secondary" onclick="backTo('screen-segment')">‚Üê –ù–∞–∑–∞–¥</button>
      <div id="error-car" class="errorBox hidden"></div>
    </div>

    <!-- –≠–ö–†–ê–ù 4: –î–ê–¢–´ -->
    <div id="screen-dates" class="hidden">
      <h1>–£–∫–∞–∂–∏—Ç–µ –¥–∞—Ç—ã –∞—Ä–µ–Ω–¥—ã</h1>
      <div class="subtitle">–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—ã –ø–æ–µ–∑–¥–∫–∏ (–±–µ–∑ –≤—Ä–µ–º–µ–Ω–∏ ‚Äî —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ).</div>

      <input type="date" id="dateFrom" />
      <input type="date" id="dateTo" />

      <button class="btn" onclick="goToContacts()">–î–∞–ª–µ–µ</button>
      <button class="btn secondary" onclick="backTo('screen-car')">‚Üê –ù–∞–∑–∞–¥</button>

      <div id="error-dates" class="errorBox hidden"></div>
    </div>

    <!-- –≠–ö–†–ê–ù 5: –ö–û–ù–¢–ê–ö–¢–´ -->
    <div id="screen-contacts" class="hidden">
      <h1>–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h1>
      <div class="subtitle">–ú–µ–Ω–µ–¥–∂–µ—Ä —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.</div>

      <input type="text" id="clientName" placeholder="–í–∞—à–µ –∏–º—è" />
      <input type="text" id="clientContact" placeholder="Telegram –∏–ª–∏ WhatsApp" />

      <button class="btn" onclick="sendBooking()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
      <button class="btn secondary" onclick="backTo('screen-dates')">‚Üê –ù–∞–∑–∞–¥</button>

      <div id="error-contacts" class="errorBox hidden"></div>
    </div>

    <!-- –≠–ö–†–ê–ù 6: –£–°–ü–ï–• -->
    <div id="screen-success" class="hidden">
      <div class="success">
        <h2>‚úÖ –ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞</h2>
        <p>–ú–µ–Ω–µ–¥–∂–µ—Ä —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.</p>
        <div class="hint">–ï—Å–ª–∏ –≤–æ–ø—Ä–æ—Å —Å—Ä–æ—á–Ω—ã–π ‚Äî –Ω–∞–ø–∏—à–∏—Ç–µ –Ω–∞–º –Ω–∞–ø—Ä—è–º—É—é –≤ Telegram.</div>
      </div>
      <button class="btn secondary" onclick="resetFlow()">–û—Å—Ç–∞–≤–∏—Ç—å –µ—â—ë –∑–∞—è–≤–∫—É</button>
    </div>

  </div>

<script>
  // –í–ê–ñ–ù–û: —Ç–≤–æ–π "–≤–µ—Ä–Ω—ã–π" Apps Script URL
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw83bucvRMn2_TNmmLoDhnVSL5Eeh3nA01-ANetMaGh7sqET43VMiTcxVKt24mx_aU/exec";

  // –î–∞–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏
  let bookingData = {};

  // –ú–∞—à–∏–Ω—ã (–ø–æ–∫–∞ –¥–µ–º–æ ‚Äî –ø–æ—Ç–æ–º —Ä–∞—Å—à–∏—Ä–∏–º)
  const cars = {
    "–ë–∞–ª–∞–Ω—Å –∫–æ–º—Ñ–æ—Ä—Ç–∞ –∏ –ø—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç–∏": [
      { name:"Hyundai Kona", price:40 },
      { name:"Mazda 2", price:35 },
      { name:"Mazda 3", price:40 },
      { name:"Honda City", price:35 }
    ],
    "–ö–æ–º—Ñ–æ—Ä—Ç –¥–ª—è —Ç—Ä–∞—Å—Å—ã –∏ –≥–æ—Ä–Ω—ã—Ö –¥–æ—Ä–æ–≥": [
      { name:"Mazda CX-5", price:52 },
      { name:"Mazda CX-30", price:50 },
      { name:"Hyundai Creta", price:45 }
    ],
    "–ü—Ä–æ—Å—Ç–æ—Ä –¥–ª—è —Å–µ–º—å–∏ –∏ –∫–æ–º–ø–∞–Ω–∏–∏": [
      { name:"Xpander (7 –º–µ—Å—Ç)", price:55 },
      { name:"Carens (7 –º–µ—Å—Ç)", price:65 }
    ],
    "–≠–ª–µ–∫—Ç—Ä–æ–º–æ–±–∏–ª–∏ –Ω–æ–≤–æ–≥–æ –ø–æ–∫–æ–ª–µ–Ω–∏—è": [
      { name:"VinFast VF7", price:60 },
      { name:"VinFast VF5", price:45 }
    ],
    "–ë–∏–∑–Ω–µ—Å –∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—å—Å–∫–∏–π –∫–ª–∞—Å—Å": [
      { name:"Mercedes C300", price:95 }
    ]
  };

  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫–∏ –≤–º–µ—Å—Ç–æ "–±–µ–ª–æ–≥–æ —ç–∫—Ä–∞–Ω–∞"
  window.onerror = function(message, source, lineno, colno) {
    const box = document.getElementById("error-city");
    if (box) {
      box.classList.remove("hidden");
      box.textContent = "JS –æ—à–∏–±–∫–∞:\n" + message + "\n" + (source || "") + ":" + lineno + ":" + colno;
    }
  };

  function show(screenId){
    document.querySelectorAll('[id^="screen-"]').forEach(el => el.classList.add('hidden'));
    const el = document.getElementById(screenId);
    if (el) el.classList.remove('hidden');
  }

  function backTo(screenId){
    show(screenId);
  }

  function setError(id, text){
    const el = document.getElementById(id);
    if (!el) return;
    if (!text) {
      el.classList.add("hidden");
      el.textContent = "";
      return;
    }
    el.classList.remove("hidden");
    el.textContent = text;
  }

  function selectCity(city){
    bookingData = {}; // –Ω–∞—á–∏–Ω–∞–µ–º —á–∏—Å—Ç–æ
    bookingData.city = city;
    setError("error-city", "");
    show("screen-segment");
  }

  function selectSegment(segment){
    bookingData.segment = segment;
    setError("error-segment", "");

    const list = document.getElementById("car-list");
    list.innerHTML = "";

    const items = cars[segment] || [];
    if (!items.length) {
      setError("error-car", "–ü–æ–∫–∞ –Ω–µ—Ç –º–∞—à–∏–Ω –≤ —ç—Ç–æ–º —Ñ–æ—Ä–º–∞—Ç–µ. –ú—ã –¥–æ–±–∞–≤–∏–º ‚Äî –≤—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥–æ–π —Ñ–æ—Ä–º–∞—Ç.");
      show("screen-car");
      return;
    }

    items.forEach(car => {
      const div = document.createElement("div");
      div.className = "card";
      div.onclick = () => selectCar(car.name, car.price);
      div.innerHTML = `
        <strong>${car.name}</strong><br>
        <span style="color:#2ecc71;">–æ—Ç $${car.price} / —Å—É—Ç–∫–∏</span>
      `;
      list.appendChild(div);
    });

    show("screen-car");
  }

  function selectCar(name, price){
    bookingData.car = name;
    bookingData.price = price;
    setError("error-car", "");
    show("screen-dates");
  }

  function goToContacts(){
    const from = document.getElementById("dateFrom").value;
    const to = document.getElementById("dateTo").value;

    if (!from || !to) {
      setError("error-dates", "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ–±–µ –¥–∞—Ç—ã.");
      return;
    }
    if (to < from) {
      setError("error-dates", "–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–Ω—å—à–µ –¥–∞—Ç—ã –Ω–∞—á–∞–ª–∞.");
      return;
    }

    bookingData.dateFrom = from;
    bookingData.dateTo = to;

    // –°—Ñ–æ—Ä–º–∏—Ä—É–µ–º –ø–æ–ª–µ, –∫–æ—Ç–æ—Ä–æ–µ —É–¥–æ–±–Ω–æ –º–µ–Ω–µ–¥–∂–µ—Ä—É –∏ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ç–≤–æ–∏–º handleMiniAppBooking(data.dates)
    bookingData.dates = `${from} ‚Äî ${to}`;

    setError("error-dates", "");
    show("screen-contacts");
  }

  async function sendBooking(){
    const name = (document.getElementById("clientName").value || "").trim();
    const contact = (document.getElementById("clientContact").value || "").trim();

    if (!name || !contact) {
      setError("error-contacts", "–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ –∫–æ–Ω—Ç–∞–∫—Ç (Telegram/WhatsApp).");
      return;
    }

    bookingData.name = name;
    bookingData.contact = contact;

    // –í–ê–ñ–ù–û: —á—Ç–æ–±—ã doPost —Ç–æ—á–Ω–æ –ø–æ–Ω—è–ª, —á—Ç–æ —ç—Ç–æ –º–∏–Ω–∏–∞–ø–ø
    bookingData.type = "miniapp_booking";

    setError("error-contacts", "");

    try {
      // –ö–õ–Æ–ß–ï–í–û–ï: –ù–ò–ö–ê–ö–ò–• headers. –ò–Ω–∞—á–µ –±—É–¥–µ—Ç preflight –∏ Apps Script –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è.
      const res = await fetch(SCRIPT_URL, {
        method: "POST",
        body: JSON.stringify(bookingData) // –±—É–¥–µ—Ç text/plain -> –±–µ–∑ preflight
      });

      // –î–∞–∂–µ –µ—Å–ª–∏ –Ω–µ–ª—å–∑—è –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ç–µ–ª–æ, —Ñ–∞–∫—Ç —É—Å–ø–µ—à–Ω–æ–≥–æ fetch —É–∂–µ –∑–Ω–∞—á–∏—Ç "–¥–æ–ª–µ—Ç–µ–ª–æ".
      // –ù–æ –ø–æ–ø—Ä–æ–±—É–µ–º –ø—Ä–æ—á–∏—Ç–∞—Ç—å JSON (–Ω–∞ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö —á–∏—Ç–∞–µ—Ç—Å—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ)
      let ok = true;
      try {
        const data = await res.json();
        ok = (data && data.status === "ok");
      } catch(e) {
        // –µ—Å–ª–∏ json –Ω–µ –ø—Ä–æ—á–∏—Ç–∞–ª—Å—è ‚Äî –≤—Å—ë —Ä–∞–≤–Ω–æ —Å—á–∏—Ç–∞–µ–º —É—Å–ø–µ—Ö–æ–º, –µ—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –Ω–µ —É–ø–∞–ª
        ok = true;
      }

      if (ok) {
        show("screen-success");
      } else {
        setError("error-contacts", "–°–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—Ç–∏–ª –æ—à–∏–±–∫–æ–π. –ü—Ä–æ–≤–µ—Ä—å Apps Script / –ª–∏—Å—Ç '–ó–∞—è–≤–∫–∏'.");
      }

    } catch (err) {
      setError("error-contacts", "–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ (—Å–µ—Ç—å/–¥–æ—Å—Ç—É–ø). –ù–æ —ç—Ç–æ —É–∂–µ –ù–ï CORS.\n" + String(err));
    }
  }

  function resetFlow(){
    bookingData = {};
    document.getElementById("dateFrom").value = "";
    document.getElementById("dateTo").value = "";
    document.getElementById("clientName").value = "";
    document.getElementById("clientContact").value = "";
    setError("error-city", "");
    setError("error-segment", "");
    setError("error-car", "");
    setError("error-dates", "");
    setError("error-contacts", "");
    show("screen-city");
  }

  // —Å—Ç–∞—Ä—Ç
  resetFlow();
  if (window.Telegram && Telegram.WebApp) {
  Telegram.WebApp.expand();
  Telegram.WebApp.disableVerticalSwipes();
}
</script>

</body>
</html>
