<script>

const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw83bucvRMn2_TNmmLoDhnVSL5Eeh3nA01-ANetMaGh7sqET43VMiTcxVKt24mx_aU/exec";

let bookingData = {};

const cars = {
"Баланс комфорта и практичности": [
{ name:"Hyundai Kona", price:40 },
{ name:"Mazda 2", price:35 }
],
"Комфорт для трассы и горных дорог": [
{ name:"Mazda CX-5", price:52 }
],
"Простор для семьи и компании": [
{ name:"Xpander", price:55 }
],
"Электромобили нового поколения": [
{ name:"VinFast VF7", price:60 }
],
"Бизнес и представительский класс": [
{ name:"Mercedes C300", price:95 }
]
};

function show(id){
  document.querySelectorAll('[id^="screen"]').forEach(el=>el.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
}

function selectCity(city){
  bookingData.city = city;
  show("screen-segment");
}

function selectSegment(segment){
  bookingData.segment = segment;

  const list = document.getElementById("car-list");
  list.innerHTML = "";

  cars[segment].forEach(car=>{
    list.innerHTML += `
    <div class="card" onclick="selectCar('${car.name}', ${car.price})">
      <strong>${car.name}</strong><br>
      <span style="color:#2ecc71;">от $${car.price} / сутки</span>
    </div>`;
  });

  show("screen-car");
}

function selectCar(name,price){
  bookingData.car = name;
  bookingData.price = price;
  show("screen-dates");
}

function goToContacts(){
  bookingData.dateFrom = document.getElementById("dateFrom").value;
  bookingData.dateTo   = document.getElementById("dateTo").value;

  if(!bookingData.dateFrom || !bookingData.dateTo){
    alert("Укажите даты аренды");
    return;
  }

  show("screen-contacts");
}

function sendBooking(){

  bookingData.name = document.getElementById("clientName").value.trim();
  bookingData.contact = document.getElementById("clientContact").value.trim();

  if(!bookingData.name || !bookingData.contact){
    alert("Введите имя и контакт");
    return;
  }

  bookingData.type = "miniapp_booking";
  bookingData.dates = bookingData.dateFrom + " — " + bookingData.dateTo;

  fetch(SCRIPT_URL,{
    method:"POST",
    body: JSON.stringify(bookingData)
  })
  .then(()=> {
    show("screen-success");
  })
  .catch(()=>{
    alert("Ошибка отправки. Попробуйте позже.");
  });

}

</script>
