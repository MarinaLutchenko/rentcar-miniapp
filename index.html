<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>RentCarNT</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
*{ box-sizing:border-box; }

html, body{
  margin:0;
  padding:0;
  overflow-x:hidden;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
  background:#0e0e0e;
  color:#fff;
}

.container{
  padding:20px;
  max-width:520px;
  margin:0 auto;
  height:100vh;
  overflow-y:auto;
}

h1{
  font-size:22px;
  margin:0 0 18px;
}

.subtitle{
  color:#8b8b8b;
  font-size:14px;
  margin-bottom:14px;
  line-height:1.35;
}

.card{
  background:#1c1c1c;
  padding:16px;
  border-radius:16px;
  margin-bottom:12px;
  cursor:pointer;
  transition:.15s;
  border:1px solid transparent;
  user-select:none;
  -webkit-tap-highlight-color:transparent;
}
.card:hover{ border:1px solid #2ecc71; }
.card:active{ transform:scale(0.99); }

.btn{
  display:block;
  width:100%;
  padding:16px;
  border-radius:14px;
  font-size:16px;
  font-weight:700;
  margin-top:12px;
  text-align:center;
  cursor:pointer;
  border:none;
  text-decoration:none;
}

.btn.primary{
  background:#2ecc71;
  color:#0e0e0e !important;
}

.btn.secondary{
  background:#1c1c1c;
  color:#ffffff !important;
  border:1px solid #2b2b2b;
  font-weight:600;
}

input{
  width:100%;
  padding:14px;
  margin-bottom:12px;
  border-radius:12px;
  border:none;
  background:#1c1c1c;
  color:#fff;
  font-size:16px;               /* –≤–∞–∂–Ω–æ: –º–∏–Ω–∏–º—É–º 16px */
  line-height:20px;
  outline:none;
  -webkit-appearance:none;
}

.hidden{ display:none !important; }

.successWrap{
  width:100%;
  max-width:420px;
  margin:0 auto;
}

.success{
  background:#1c1c1c;
  padding:18px;
  border-radius:16px;
  text-align:center;
}

.success h2{
  margin:0 0 10px;
  font-size:22px;
}

.hint{
  margin-top:12px;
  color:#9a9a9a;
  font-size:13px;
}

.errorBox{
  margin-top:14px;
  background:#2b1515;
  border:1px solid #8a2e2e;
  color:#ffd9d9;
  padding:12px;
  border-radius:12px;
  font-size:13px;
  white-space:pre-wrap;
}
</style>
</head>

<body>
<div class="container">

<!-- –ì–û–†–û–î -->
<div id="screen-city">
  <h1>–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥ –∞—Ä–µ–Ω–¥—ã</h1>

  <div class="card" onclick="selectCity('–ù—è—á–∞–Ω–≥')">üèù –ù—è—á–∞–Ω–≥</div>
  <div class="card" onclick="selectCity('–ú—É–π–Ω–µ/–§–∞–Ω—Ç—å–µ—Ç')">üå¥ –ú—É–π–Ω–µ/–§–∞–Ω—Ç—å–µ—Ç</div>
  <div class="card" onclick="selectCity('–§—É–∫—É–æ–∫')">üèñÔ∏è –§—É–∫—É–æ–∫</div>
  <div class="card" onclick="selectCity('–î–∞–Ω–∞–Ω–≥')">üåÖ –î–∞–Ω–∞–Ω–≥</div>
  <div class="card" onclick="selectCity('–•–æ—à–∏–º–∏–Ω')">üèô –•–æ—à–∏–º–∏–Ω</div>
  <div class="card" onclick="selectCity('–•–∞–Ω–æ–π')">üèõ –•–∞–Ω–æ–π</div>

  <div id="error-city" class="errorBox hidden"></div>
</div>

<!-- –°–ï–ì–ú–ï–ù–¢ -->
<div id="screen-segment" class="hidden">
  <h1>–ö–∞–∫–æ–π —Ñ–æ—Ä–º–∞—Ç –∞–≤—Ç–æ –≤–∞–º –ø–æ–¥–æ–π–¥—ë—Ç?</h1>

  <!-- –°—é–¥–∞ —Å–µ–≥–º–µ–Ω—Ç—ã –≤—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
  <div id="segment-list"></div>

  <button class="btn secondary" onclick="backTo('screen-city')">‚Üê –ù–∞–∑–∞–¥</button>
  <div id="error-segment" class="errorBox hidden"></div>
</div>

<!-- –ú–ê–®–ò–ù–´ -->
<div id="screen-car" class="hidden">
  <h1>–í—ã–±–µ—Ä–∏—Ç–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—å</h1>
  <div class="subtitle" id="car-subtitle">–ü–æ–∫–∞–∂–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –∏–∑ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞.</div>
  <div id="car-list"></div>

  <button class="btn secondary" onclick="backTo('screen-segment')">‚Üê –ù–∞–∑–∞–¥</button>
  <div id="error-car" class="errorBox hidden"></div>
</div>

<!-- –î–ê–¢–´ -->
<div id="screen-dates" class="hidden">
  <h1>–£–∫–∞–∂–∏—Ç–µ –¥–∞—Ç—ã –∞—Ä–µ–Ω–¥—ã</h1>
  <div class="subtitle">–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—ã –ø–æ–µ–∑–¥–∫–∏.</div>

  <input type="date" id="dateFrom" />
  <input type="date" id="dateTo" />

  <button class="btn primary" onclick="goToTrip()">–î–∞–ª–µ–µ</button>
  <button class="btn secondary" onclick="backTo('screen-car')">‚Üê –ù–∞–∑–∞–¥</button>

  <div id="error-dates" class="errorBox hidden"></div>
</div>

<!-- –ù–ê–ü–†–ê–í–õ–ï–ù–ò–ï -->
<div id="screen-trip" class="hidden">
  <h1>–ö—É–¥–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –ø–æ–µ–∑–¥–∫–∞?</h1>
  <div class="subtitle">–≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –º–µ–Ω–µ–¥–∂–µ—Ä—É –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –ø–æ–¥—Ö–æ–¥—è—â–∏–π –∞–≤—Ç–æ–º–æ–±–∏–ª—å.</div>

  <input type="text" id="tripDirection" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –î–∞–ª–∞—Ç, –ú—É–π–Ω–µ, –ø–æ –≥–æ—Ä–æ–¥—É, —Ç—Ä–∞—Å—Å–∞" />

  <button class="btn primary" onclick="goToContacts()">–î–∞–ª–µ–µ</button>
  <button class="btn secondary" onclick="backTo('screen-dates')">‚Üê –ù–∞–∑–∞–¥</button>

  <div id="error-trip" class="errorBox hidden"></div>
</div>

<!-- –ö–û–ù–¢–ê–ö–¢–´ -->
<div id="screen-contacts" class="hidden">
  <h1>–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h1>
  <div class="subtitle">–ú–µ–Ω–µ–¥–∂–µ—Ä —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.</div>

  <input type="text" id="clientName" placeholder="–í–∞—à–µ –∏–º—è" />
  <input type="text" id="clientContact" placeholder="Telegram –∏–ª–∏ WhatsApp" />

  <button id="submitBtn" class="btn primary" onclick="sendBooking()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
  <button class="btn secondary" onclick="backTo('screen-trip')">‚Üê –ù–∞–∑–∞–¥</button>

  <div id="error-contacts" class="errorBox hidden"></div>
</div>

<!-- –£–°–ü–ï–• -->
<div id="screen-success" class="hidden">
  <div class="successWrap">

    <div class="success">
      <h2>‚úÖ –ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞</h2>
      <p>–ú–µ–Ω–µ–¥–∂–µ—Ä —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.</p>
      <div class="hint">–ï—Å–ª–∏ –≤–æ–ø—Ä–æ—Å —Å—Ä–æ—á–Ω—ã–π ‚Äî –Ω–∞–ø–∏—à–∏—Ç–µ –Ω–∞–º –Ω–∞–ø—Ä—è–º—É—é.</div>
    </div>

    <a class="btn primary" href="https://t.me/RentCarNT" target="_blank" rel="noopener">
      ‚úâÔ∏è –ù–∞–ø–∏—Å–∞—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä—É
    </a>

    <button class="btn secondary" onclick="resetFlow()">–û—Å—Ç–∞–≤–∏—Ç—å –µ—â—ë –∑–∞—è–≤–∫—É</button>

  </div>
</div>

</div>

<script>
// ‚úÖ –¢–í–û–ô Apps Script URL (–ù–ï –¢–†–û–ì–ê–ï–ú)
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxH2pXULpUwnbxHSeactHW3FjfSOeVl6CmE7KzXrbV4UdKzXg3vcCShxVuqek93PdZh/exec";

let bookingData = {};
let isSubmitting = false;

// ‚úÖ –°–µ–≥–º–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ç—ã —É—Ç–≤–µ—Ä–¥–∏–ª–∞
const SEGMENTS = [
  { key:"–ì–æ—Ä–æ–¥—Å–∫–∞—è –µ–∑–¥–∞ –∏ –ø—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å", icon:"üöó" },
  { key:"–ö—Ä–æ—Å—Å–æ–≤–µ—Ä—ã –∏ –ø–æ–µ–∑–¥–∫–∞ –≤ –≥–æ—Ä—ã", icon:"üöô" },
  { key:"7 –º–µ—Å—Ç –∏ —Å–µ–º–µ–π–Ω—ã–µ –∞–≤—Ç–æ", icon:"üë®‚Äçüë©‚Äçüëß" },
  { key:"–≠–ª–µ–∫—Ç—Ä–æ", icon:"‚ö°" },
  { key:"–õ—é–∫—Å –∏ –ø—Ä–µ–º–∏—É–º", icon:"üíé" } // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤ –≥–æ—Ä–æ–¥–µ –µ—Å—Ç—å —Ç–∞–∫–∏–µ –º–∞—à–∏–Ω—ã
];

// ‚úÖ –ú–∞—à–∏–Ω—ã —Å—Ç—Ä–æ–≥–æ –ø–æ —Ç–≤–æ–µ–º—É —Å–ø–∏—Å–∫—É, –ø–æ –≥–æ—Ä–æ–¥–∞–º –∏ —Å–µ–≥–º–µ–Ω—Ç–∞–º
const carsByCity = {

"–ù—è—á–∞–Ω–≥": {
  "–ì–æ—Ä–æ–¥—Å–∫–∞—è –µ–∑–¥–∞ –∏ –ø—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å": [
    { name:"Mazda 2", price:40 },
    { name:"Mazda 3", price:45 },
    { name:"Mazda 3 2018", price:40 },
    { name:"Kia Soluto", price:40 },
    { name:"Toyota Raize", price:43 },
    { name:"Kia Cerato", price:45 },
    { name:"Honda City", price:45 }
  ],
  "–ö—Ä–æ—Å—Å–æ–≤–µ—Ä—ã –∏ –ø–æ–µ–∑–¥–∫–∞ –≤ –≥–æ—Ä—ã": [
    { name:"Mazda CX 30", price:45 },
    { name:"Mazda CX 5", price:52 },
    { name:"Hyundai Creta", price:46 },
    { name:"Hyundai Kona", price:40 },
    { name:"Honda HRV", price:46 },
    { name:"Toyota Veloz", price:50 },
    { name:"VinFast Lux", price:52 }
  ],
  "7 –º–µ—Å—Ç –∏ —Å–µ–º–µ–π–Ω—ã–µ –∞–≤—Ç–æ": [
    { name:"Hyundai Custin", price:65 },
    { name:"Kia Carnival", price:90 },
    { name:"Xpander", price:45 },
    { name:"BYD M6", price:55 },
    { name:"Kia Carens", price:48 }
  ],
  "–≠–ª–µ–∫—Ç—Ä–æ": [
    { name:"VinFast VF 3", price:35 },
    { name:"VinFast VF 7", price:84 },
    { name:"VinFast VF 9", price:90 },
    { name:"Vinfast limo green", price:null }
  ],
  "–õ—é–∫—Å –∏ –ø—Ä–µ–º–∏—É–º": [
    { name:"Mercedes GLS", price:150 },   // –º–æ–∂–µ—à—å –º–µ–Ω—è—Ç—å
    { name:"Mercedes E200", price:110 }   // –º–æ–∂–µ—à—å –º–µ–Ω—è—Ç—å
  ]
},

"–ú—É–π–Ω–µ/–§–∞–Ω—Ç—å–µ—Ç": {
  "–ì–æ—Ä–æ–¥—Å–∫–∞—è –µ–∑–¥–∞ –∏ –ø—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å": [
    { name:"Mazda 3", price:45 },
    { name:"Toyota Vios", price:45 },
    { name:"Honda City", price:45 },
    { name:"Hyundai Accent", price:45 },
    { name:"Kia Sonet", price:45 },
    { name:"MG5", price:50 }
  ],
  "–ö—Ä–æ—Å—Å–æ–≤–µ—Ä—ã –∏ –ø–æ–µ–∑–¥–∫–∞ –≤ –≥–æ—Ä—ã": [
    { name:"Xforce", price:60 }
  ],
  "7 –º–µ—Å—Ç –∏ —Å–µ–º–µ–π–Ω—ã–µ –∞–≤—Ç–æ": [
    { name:"Kia Sedona", price:65 },
    { name:"Kia Carens", price:55 },
    { name:"Beijing M6", price:60 }
  ],
  "–≠–ª–µ–∫—Ç—Ä–æ": [],
  "–õ—é–∫—Å –∏ –ø—Ä–µ–º–∏—É–º": []
},

"–•–æ—à–∏–º–∏–Ω": {
  "–ì–æ—Ä–æ–¥—Å–∫–∞—è –µ–∑–¥–∞ –∏ –ø—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å": [
    { name:"Vios", price:45 },
    { name:"Elentra", price:48 },
    { name:"Accent", price:45 },
    { name:"Venue", price:45 },
    { name:"MG5", price:50 }
  ],
  "–ö—Ä–æ—Å—Å–æ–≤–µ—Ä—ã –∏ –ø–æ–µ–∑–¥–∫–∞ –≤ –≥–æ—Ä—ã": [
    { name:"Creta", price:53 },
    { name:"X foce", price:53 },
    { name:"Mg rx 5", price:52 }
  ],
  "7 –º–µ—Å—Ç –∏ —Å–µ–º–µ–π–Ω—ã–µ –∞–≤—Ç–æ": [
    { name:"Fortuner", price:65 },
    { name:"X pander", price:53 },
    { name:"Custin", price:68 },
    { name:"Canival", price:105 },
    { name:"Ford Everet", price:68 },
    { name:"Ford ranger", price:60 }
  ],
  "–≠–ª–µ–∫—Ç—Ä–æ": [],
  "–õ—é–∫—Å –∏ –ø—Ä–µ–º–∏—É–º": [
    { name:"Porsche 911 Carrera", price:null },
    { name:"BMW 740", price:null },
    { name:"BMW 730", price:null },
    { name:"Porsche Cayenne", price:null }
  ]
},

"–§—É–∫—É–æ–∫": {
  "–ì–æ—Ä–æ–¥—Å–∫–∞—è –µ–∑–¥–∞ –∏ –ø—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å": [
    { name:"Toyota Wigo", price:40 },
    { name:"Hyundai accent", price:40 },
    { name:"Vios", price:45 },
    { name:"Hyundai Elantra", price:45 }
  ],
  "–ö—Ä–æ—Å—Å–æ–≤–µ—Ä—ã –∏ –ø–æ–µ–∑–¥–∫–∞ –≤ –≥–æ—Ä—ã": [
    { name:"Kia Seltos", price:52 }
  ],
  "7 –º–µ—Å—Ç –∏ —Å–µ–º–µ–π–Ω—ã–µ –∞–≤—Ç–æ": [
    { name:"Xpander", price:60 }
  ],
  "–≠–ª–µ–∫—Ç—Ä–æ": [],
  "–õ—é–∫—Å –∏ –ø—Ä–µ–º–∏—É–º": [
    { name:"Lexus ES250", price:140 },
    { name:"Mercedes e200", price:85 },
    { name:"BMW 320", price:80 }
  ]
},

"–•–∞–Ω–æ–π": {
  "–ì–æ—Ä–æ–¥—Å–∫–∞—è –µ–∑–¥–∞ –∏ –ø—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å": [
    { name:"Mazda 3", price:50 }
  ],
  "–ö—Ä–æ—Å—Å–æ–≤–µ—Ä—ã –∏ –ø–æ–µ–∑–¥–∫–∞ –≤ –≥–æ—Ä—ã": [
    { name:"Mazda cx5", price:56 },
    { name:"Hyundai Kona", price:48 },
    { name:"MG zs", price:53 },
    { name:"Vinfast lux", price:55 }
  ],
  "7 –º–µ—Å—Ç –∏ —Å–µ–º–µ–π–Ω—ã–µ –∞–≤—Ç–æ": [],
  "–≠–ª–µ–∫—Ç—Ä–æ": [],
  "–õ—é–∫—Å –∏ –ø—Ä–µ–º–∏—É–º": []
},

"–î–∞–Ω–∞–Ω–≥": {
  "–ì–æ—Ä–æ–¥—Å–∫–∞—è –µ–∑–¥–∞ –∏ –ø—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å": [
    { name:"Mazda 3", price:50 }
  ],
  "–ö—Ä–æ—Å—Å–æ–≤–µ—Ä—ã –∏ –ø–æ–µ–∑–¥–∫–∞ –≤ –≥–æ—Ä—ã": [
    { name:"Mazda cx5", price:56 },
    { name:"Hyundai Kona", price:48 }
  ],
  "7 –º–µ—Å—Ç –∏ —Å–µ–º–µ–π–Ω—ã–µ –∞–≤—Ç–æ": [
    { name:"Ford ranger", price:65 }
  ],
  "–≠–ª–µ–∫—Ç—Ä–æ": [],
  "–õ—é–∫—Å –∏ –ø—Ä–µ–º–∏—É–º": []
}

};
// -------------------- UI helpers --------------------
function show(id){
  document.querySelectorAll('[id^="screen-"]').forEach(el => el.classList.add('hidden'));
  const el = document.getElementById(id);
  if (el) el.classList.remove('hidden');
}

function backTo(id){ show(id); }

function setError(id,text){
  const el = document.getElementById(id);
  if (!el) return;
  if(!text){
    el.classList.add("hidden");
    el.textContent="";
    return;
  }
  el.classList.remove("hidden");
  el.textContent=text;
}

// -------------------- Flow --------------------
function selectCity(city){
  bookingData = {};
  bookingData.city = city;

  // —Ä–∏—Å—É–µ–º —Å–µ–≥–º–µ–Ω—Ç—ã –ø–æ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –≥–æ—Ä–æ–¥ (–∏ —Å–∫—Ä—ã–≤–∞–µ–º –ø—É—Å—Ç—ã–µ)
  renderSegmentsForCity(city);

  show("screen-segment");
}

function renderSegmentsForCity(city){
  const wrap = document.getElementById("segment-list");
  wrap.innerHTML = "";

  const cityObj = carsByCity[city] || {};

  SEGMENTS.forEach(seg => {
    const list = cityObj[seg.key] || [];
    if (!list.length) return; // ‚úÖ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–≥–º–µ–Ω—Ç, –µ—Å–ª–∏ –≤ –≥–æ—Ä–æ–¥–µ –ø—É—Å—Ç–æ

    const div = document.createElement("div");
    div.className = "card";
    div.onclick = () => selectSegment(seg.key);
    div.textContent = `${seg.icon} ${seg.key}`;
    wrap.appendChild(div);
  });

  // –µ—Å–ª–∏ –≤–¥—Ä—É–≥ –≤—Å—ë –ø—É—Å—Ç–æ–µ
  if (!wrap.children.length){
    setError("error-segment", "–í —ç—Ç–æ–º –≥–æ—Ä–æ–¥–µ –ø–æ–∫–∞ –Ω–µ—Ç –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π. –í—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥–æ–π –≥–æ—Ä–æ–¥.");
  } else {
    setError("error-segment", "");
  }
}

function selectSegment(segment){
  bookingData.segment = segment;

  const list = document.getElementById("car-list");
  list.innerHTML = "";

  const city = bookingData.city;
  const items = (carsByCity[city] && carsByCity[city][segment]) ? carsByCity[city][segment] : [];

  if(!items.length){
    setError("error-car","–í —ç—Ç–æ–º –≥–æ—Ä–æ–¥–µ –Ω–µ—Ç –∞–≤—Ç–æ –¥–∞–Ω–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞.");
    show("screen-car");
    return;
  }

  // –ª—é–∫—Å: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É –ø—Ä–æ –¥–æ—Å—Ç–∞–≤–∫—É/–∑–∞–ø—Ä–æ—Å
  const subtitle = document.getElementById("car-subtitle");
  if (segment === "–õ—é–∫—Å –∏ –ø—Ä–µ–º–∏—É–º"){
    subtitle.textContent = "–ê–≤—Ç–æ–º–æ–±–∏–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ —ç—Ç–æ–º –≥–æ—Ä–æ–¥–µ –∏–ª–∏ –ø–æ –∑–∞–ø—Ä–æ—Å—É (—É—Ç–æ—á–Ω—è–π—Ç–µ —É –º–µ–Ω–µ–¥–∂–µ—Ä–∞).";
  } else {
    subtitle.textContent = "–ü–æ–∫–∞–∂–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –∏–∑ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞.";
  }

  items.forEach(car => {
    const div = document.createElement("div");
    div.className = "card";
    div.onclick = () => selectCar(car.name, car.price);

    const priceLine = (car.price === null || car.price === undefined)
      ? `<span style="color:#8b8b8b;">—Ü–µ–Ω–∞ –ø–æ –∑–∞–ø—Ä–æ—Å—É</span>`
      : `<span style="color:#2ecc71;">–æ—Ç $${car.price} / —Å—É—Ç–∫–∏</span>`;

    div.innerHTML = `<strong>${car.name}</strong><br>${priceLine}`;
    list.appendChild(div);
  });

  setError("error-car","");
  show("screen-car");
}

function selectCar(name,price){
  bookingData.car = name;
  bookingData.price = price;
  show("screen-dates");
}

function goToTrip(){
  const from = document.getElementById("dateFrom").value;
  const to   = document.getElementById("dateTo").value;

  if(!from || !to){
    setError("error-dates","–í—ã–±–µ—Ä–∏—Ç–µ –æ–±–µ –¥–∞—Ç—ã.");
    return;
  }

  if(to < from){
    setError("error-dates","–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ä–∞–Ω—å—à–µ –¥–∞—Ç—ã –Ω–∞—á–∞–ª–∞.");
    return;
  }

  bookingData.dateFrom = from;
  bookingData.dateTo   = to;
  bookingData.dates    = `${from} ‚Äî ${to}`;

  setError("error-dates","");
  show("screen-trip");
}

function goToContacts(){
  const trip = (document.getElementById("tripDirection").value || "").trim();
  if(!trip){
    setError("error-trip","–ù–∞–ø–∏—à–∏—Ç–µ, –∫—É–¥–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –ø–æ–µ–∑–¥–∫–∞.");
    return;
  }
  bookingData.tripDirection = trip;
  setError("error-trip","");
  show("screen-contacts");
}

async function sendBooking(){
  if(isSubmitting) return;
  isSubmitting = true;

  const btn = document.getElementById("submitBtn");
  btn.disabled = true;
  btn.style.opacity = "0.6";
  btn.textContent = "–û—Ç–ø—Ä–∞–≤–∫–∞...";

  if(document.activeElement) document.activeElement.blur();

  const name = (document.getElementById("clientName").value || "").trim();
  const contact = (document.getElementById("clientContact").value || "").trim();

  if(!name || !contact){
    setError("error-contacts","–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ –∫–æ–Ω—Ç–∞–∫—Ç.");
    isSubmitting=false;
    btn.disabled=false;
    btn.style.opacity="1";
    btn.textContent="–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É";
    return;
  }

  bookingData.name = name;
  bookingData.contact = contact;
  bookingData.type = "miniapp_booking";

  // ‚úÖ –í–ê–ñ–ù–û: —á—Ç–æ–±—ã –º–µ–Ω–µ–¥–∂–µ—Ä—É —Ç–æ—á–Ω–æ –±—ã–ª–æ –≤–∏–¥–Ω–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–∏ —á—Ç–æ–±—ã –Ω–µ ‚Äú—Ç–µ—Ä—è–ª–æ—Å—å‚Äù)
  bookingData.destination = bookingData.tripDirection;

  setError("error-contacts","");

  try{
    await fetch(SCRIPT_URL, {
      method:"POST",
      body: JSON.stringify(bookingData)
    });

    show("screen-success");
  }catch(e){
    setError("error-contacts","–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏.");
    isSubmitting=false;
    btn.disabled=false;
    btn.style.opacity="1";
    btn.textContent="–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É";
  }
}

function resetFlow(){
  bookingData = {};
  isSubmitting = false;

  document.getElementById("dateFrom").value = "";
  document.getElementById("dateTo").value = "";
  document.getElementById("tripDirection").value = "";
  document.getElementById("clientName").value = "";
  document.getElementById("clientContact").value = "";

  setError("error-city","");
  setError("error-segment","");
  setError("error-car","");
  setError("error-dates","");
  setError("error-trip","");
  setError("error-contacts","");

  show("screen-city");
}

// -------------------- Telegram height fix (–æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–≤–æ–π —Ä–∞–±–æ—á–∏–π) --------------------
if(window.Telegram && Telegram.WebApp){
  const tg = Telegram.WebApp;
  tg.expand();
  function applyHeight(){
    document.documentElement.style.height = tg.viewportStableHeight + "px";
    document.body.style.height = tg.viewportStableHeight + "px";
  }
  applyHeight();
  tg.onEvent("viewportChanged", applyHeight);
}

// —Å—Ç–∞—Ä—Ç
resetFlow();
</script>
</body>
</html>
